

## Dependence
This script is tested under Python 3.12.4.
Also, Python 2.7.17 is required to run Rosetta related scripts.
Other software and libraries that need to be installed:
- acpype
- ambertools
- biopython
- openbabel
- pdb4amber
- rdkit
## Automated Rosetta and Gromacs Parameterization Generation
### Input
An **input.smiles** file which contains SMILES format test of your molecule is required, the content is similar to the following form:

`N[C@H](C(O)=O)CC1=C(C(F)=C(C(F)=C1F)F)F`

Note: If you want to process multiple SMILES at once, you can separate them with line breaks. And there should be no empty lines at the beginning, end, or middle of the file. At the same time, you need to ensure that the number of NCAA three letter abbreviations entered in **-n** command matches the number of SMILES that are entered. Although this is feasible, it is **<font color=red>not recommended</font>** to add multiple smiles at once in input.smiles, as this may cause errors during runtime
### Run
In order to generate Rosetta and Gromacs parameters, you can refer to the following steps:
1. Create a specific folder for your NCAA
2. Place the **script** and **input.smiles** file into this folder
3. Enter the following command to run the script
```
cd ~/YOUR_NCAA_FOLDER
python R_G_parameterize.py -i input.smiles -n UAA
```
Required:
-i: your NCAA's SMILES
-n: your NCAA's three letter abbreviation

Optional:
-c: whether or not delete intermediate files, accept 0 or 1 as its parameter. 0 stands for 'do not delete', 1 stands for 'delete'. Default delete
### Output
Finally you will find your Rosetta parameter files, Rosetta temporary parameter files, and Gromacs parameter files in the current folder
## PDB ROTAMERS Generation
### Input
To generate PDB ROTAMERS, two input files are required here£º
- input.smiles 
which is the same as the one used in the parameterization process
- UAA_temps.params 
which is generated by the parameterization process
### Run
In order to generate PDB ROTAMERS, you can refer to the following steps:
1. Create a new folder for your NCAA, and place the **script** and the **required files** into this folder
2. Enter the following command to run the script
```
cd ~/YOUR_NEW_FOLDER
python PDB_rotamer.py -i input.smiles -n UAA -m UAA_temps.params
```
Required:
-n: your NCAA's three letter abbreviation
-m: Your NCAA's corresponding temporary parameter file

Optional:
-d: User defined RMSD threshold, accept any floating-point number as its parameter
-c: User defined conformation number cut_off value, accept any integer as its parameter

When -d and -c are not manually defined, they will be automatically classified based on the input number of chi angles in NCAA, basically according to the following table£º

||Chi=1|Chi=2|Chi=3|Chi=4|Chi¡Ý5|
|-|-|-|-|-|-|
|RMSD threshold|0.8|0.6|0.4|0.2|0.1|
|Cut_off|10|30|90|270|810|

The above parameters are sufficient to handle most situations, a few special NCAA cases require users to manually set the RMSD threshold and cut_off value according to the actual situation

### Output
The program takes around 5 to 10 minutes to perform calculations. After running, you will find a pdb file named '**merged_combined_pdb_files.pdb**' in the current folder, which is your NCAA's PDB ROTAMER. 
Copy its path, and paste
`PDB_ROTAMERS ~/YOUR_PDB_ROTAMERS_PATH/merged_combined_pdb_files.pdb`
on the last line of your UAA.params file to use it.
## Rotlib Generation
### Input
To generate Rotlib, **UAA.params** file is required, which is also generated by the parameterization process
### Run
In order to generate Rotlib, you can refer to the following steps:
1. Create a new folder for your NCAA, and place the **script** and the **required files** into this folder
2. Enter the following command to run
```
cd ~/YOUR_ROTLIB_FOLDER
python depart.py UAA n x1 x2 x3 x4
```
UAA: the three letter abbreviation of your NCAA
n: the number of chi angles
x1, x2, x3, x4: list of rotawell values representing rotary wells

This script will generate a list file named '**MRL_job_UAA.list**', transfer it along with the **run.sh** file and **UAA.params** file to the supercomputer, and enter the following command:
```
sbatch run.sh
```
The program takes hours to perform calculations. After running, enter the following command to put all rotlib files together:
```
~/make_final_from_phi_psi.pl UAA
```
### Output
 you will find a file named '**UAA.rotlib**' in the current folder, which is your NCAA's Rotlib. 
Copy its path, and paste
```
NCAA_ROTLIB_PATH ~/YOUR_ROTLIB_PATH/UAA.rotlib
NCAA_ROTLIB_NUM_ROTAMER_BINS x1 x2 x3 x4 
```
on the last line of your UAA.params file to use it.
## NCAA Regeneration
In order to comprehensively evaluate which of PDB ROTAMERS and Rotlib has better conformational search performance, we compared the two through NCAA regeneration experiments. 
Here, we evaluated the conformational similarity of NCAA before and after regeneration using parameters such as **Energy_score, RMSD,** and **Chi_deviation**. 
We also calculated the delta values of the PDB ROTAMERS group and Rotlib group to quantitatively compare their performance.
### Input
The **UAA.params** file and the **pdb** file containing UAA are required
### Run
In order to regenerate the NCAA, you can refer to the following steps:
1. Create a new folder for your NCAA, and place the **script** and the **required files** into this folder
2. Enter the following command to run
```
cd ~/YOUR_REGENERATION_FOLDER
~/YOUR_ROSETTA_PATH/main/source/bin/rosetta_scripts.static.linuxgccrelease -parser:protocol ./chi_packing.xml -parser:script_vars resnum="x1" new_ncaa="UAA" -s ./x2.pdb -extra_res_fa ./UAA.params  @chi_packing_flag
```
x1: the AA-index of your NCAA
x2: the pdb name that contains your NCAA
UAA: the three letter abbreviation of your NCAA

For different cases, need to provide different numbers, pdb names, and NCAA three letter abbreviations. For easy access, the commands used in this experiment are stored in the **command.txt** file.
### Output
Each case will generate 100 result files and one scoring file in the current folder
### Performance Comparison
In this section, we searched the one with the lowest Energy_score of 100 outputs from last step, and evaluate the regeneration quality by calculating RMSD and Chi_deviation to compare the performance of PDB ROTAMERS and Rotlib
#### additional required files
- UAA.pdb
Your NCAA's original conformation pdb, which is extracted form protein pdb file
- chi.txt
which contains the angle of each chi, and the text format is as follows:
```
chi1=-63.76922
chi2=-84.38538
chi3=-40.80490
```
Note: the order of chi needs to be consistent with the chi angle order described in params
#### run
Putting the additional required files into your regeneration folder, and enter the following command:
```
cd ~/YOUR_REGENERATION_FOLDER
python score_rmsd_chi.py -n UAA -i y1 -r UAA.pdb
```
-n: your NCAA's three letter abbreviation
-i: prefixes of 100 output pdbs. For example, if your output pdb file named '4ah7_opt_XXXX.pdb', then -i takes '4ah7' as its parameter
-r: Your NCAA's original conformation pdb
#### results
The result files are
- rmsd_results.csv
which contains the RMSD value of each output
- CHI_results.csv
which contains the Chi_deviation value of each output
- result.txt
points out which output has the lowest Energy_score, and gives the exact value of Energy_score, RMSD and Chi_deviation
#### comparison
in order to compare the performance between PDB ROTAMERS and Rotlib, we calculated the delta values between them in each case using the following functions:

ΔEnergy_score = Energy_score<sub>PDB_ROTAMERS</sub> - Energy_score<sub>Rotlib</sub>
ΔRMSD = RMSD<sub>PDB_ROTAMERS</sub> - RMSD<sub>Rotlib</sub>
ΔChi_deviation = 0.7×(Chi1_deviation<sub>PDB_ROTAMERS</sub> - Chi1_deviation<sub>Rotlib</sub>) + 0.3×(Chi2_deviation<sub>PDB_ROTAMERS</sub> - Chi2_deviation<sub>Rotlib</sub>)

The more negative the value is, the better the performance of PDB ROTARERS
The more positive the value is, the better the performance of Rotlib
